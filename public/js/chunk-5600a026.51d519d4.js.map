{"version":3,"sources":["webpack:///./src/components/base/WebPush.vue","webpack:///./src/components/base/WebPush.vue?5d30","webpack:///./src/components/base/WebPush.vue?2019","webpack:///./src/pages/home/Home.vue","webpack:///./src/pages/home/Home.vue?727b"],"names":["id","pushMessage","length","interval","arrow","direction","indicator-position","item","index","key","title","message","effect","show-icon","showIcon","closable","type","alertType","name","props","Boolean","default","showWeather","Number","String","computed","data","this","$store","state","configuration","notice","lists","JSON","stringify","Permission","weather","casts","timestamp","Date","parse","forEach","push","mounted","$nextTick","getConfiguration","getConnection","methods","SocketService","socket","transports","autoConnect","on","console","info","emit","uuid","$response","$unread","disabled","see","dispatch","unread","xAxisData","day","seriesData","total","$message","clientLog","time","username","$error","error","keywords","__exports__","render","body","show-weather","alert-type","load-more","loadMore","components","Lists","HomeLayout","WebPush","pagination","page","limit","source","imageLists","beforeUnmount","window","removeEventListener","handleScroll","created","addEventListener","getImageLists","loading","$loading","lock","text","spinner","background","concat","close","scrollTop","document","documentElement","scrollHeight","innerHeight"],"mappings":"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","file":"js/chunk-5600a026.51d519d4.js","sourcesContent":["<template>\n  <div id=\"webPush\">\n    <el-carousel\n      v-if=\"pushMessage.length > 0\"\n      :interval=\"interval\"\n      arrow=\"never\"\n      direction=\"vertical\"\n      indicator-position=\"none\">\n      <el-carousel-item v-for=\"(item,index) in pushMessage\" :key=\"index\">\n        <el-alert\n          :title=\"item.message\"\n          :effect=\"effect\"\n          :show-icon=\"showIcon\"\n          :closable=\"closable\"\n          :type=\"alertType\">\n        </el-alert>\n      </el-carousel-item>\n    </el-carousel>\n  </div>\n</template>\n\n<script>\n\nimport SocketIO from 'socket.io-client';\nimport { setTime } from '@/utils/func';\n\nexport default {\n  name: 'WebPush',\n  props: {\n    showIcon: {\n      type: Boolean,\n      default: () => true\n    },\n    closable: {\n      type: Boolean,\n      default: () => true\n    },\n    showWeather: {\n      type: Boolean,\n      default: () => true\n    },\n    interval: {\n      type: Number,\n      default: () => 2000\n    },\n    alertType: {\n      type: String,\n      default: () => 'success'\n    },\n    effect: {\n      type: String,\n      default: () => 'light'\n    }\n  },\n  computed: {\n    pushMessage() {\n      const data = this.$store.state.index.configuration.notice;\n      const lists = this.showWeather ? [{ message: JSON.stringify((this.Permission.weather || {}).casts || ''), timestamp: Date.parse(new Date()) / 1000 }] : [];\n      data.forEach((item, index) => {\n        lists.push({ message: item, timestamp: Date.parse(new Date()) / 1000 + index});\n      });\n      return lists;\n    }\n  },\n  mounted() {\n    this.$nextTick(async () => {\n      await this.getConfiguration();\n      if (this.Permission) {\n        this.getConnection();\n      }\n    });\n  },\n  methods: {\n    /**\n     * todo:获取推送链接\n     */\n    getConnection() {\n      const SocketService = SocketIO(this.Permission.socket, {\n        transports: ['websocket'],\n        autoConnect: true\n      });\n      /* todo:链接系统 */\n      SocketService.on('connect', () => {\n        console.info(`【登录系统】${setTime(Date.parse(new Date()))}`);\n        /* todo:用户登录 */\n        SocketService.emit('login', this.Permission.uuid);\n      });\n      /* todo:获取站内推送信息 */\n      SocketService.on('notice', ($response) => {\n        if ($response.length > 0) {\n          let $unread = 0;\n          $response.forEach(item => {\n            item.disabled = (item.state === 'successfully' && item.see > 0);\n            if (!item.disabled) {\n              $unread += 1;\n            }\n          });\n          this.$store.dispatch('home/saveSocketMessage', { notice: $response, unread: $unread });\n        }\n      });\n      /* todo：获取图表信息 */\n      SocketService.on('charts', ($response) => {\n        this.$store.dispatch('home/saveSocketMessage', { xAxisData: $response.day, seriesData: $response.total });\n      });\n      /* todo:站内消息推送 */\n      SocketService.on('new_message', ($message) => {\n        this.pushMessage.push({ message: $message, timestamp: Date.parse(new Date()) / 1000 });\n        let clientLog = { time: setTime(Date.parse(new Date()), 'ch'), message: $message, username: '系统公告' };\n        this.$store.dispatch('chat/addClientLog', clientLog);\n      });\n      /* todo:链接断开 */\n      SocketService.on('disconnect', ($error) => {\n        console.info(`【系统断开】${setTime(Date.parse(new Date()))}${JSON.stringify($error)}`);\n      });\n      /* todo:链接错误 */\n      SocketService.on('connect_error', ($error) => {\n        console.error(`【系统链接错误】${setTime(Date.parse(new Date()))}${JSON.stringify($error)}`);\n      });\n    },\n    /**\n     * todo:获取系统通知\n     * @returns {Promise<void>}\n     */\n    async getConfiguration() {\n      await this.$store.dispatch('index/getConfiguration', { keywords: 'NOTICE', type: 'notice' });\n    }\n  }\n};\n</script>\n\n<style lang=\"less\">\n#webPush {\n  .el-carousel__container {\n    height: 40px !important;\n    margin: 0 5px;\n  }\n}\n</style>\n","import { render } from \"./WebPush.vue?vue&type=template&id=1dc44e53\"\nimport script from \"./WebPush.vue?vue&type=script&lang=js\"\nexport * from \"./WebPush.vue?vue&type=script&lang=js\"\n\nimport \"./WebPush.vue?vue&type=style&index=0&id=1dc44e53&lang=less\"\n\nimport exportComponent from \"D:\\\\phpstudy_pro\\\\WWW\\\\vue-app\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./WebPush.vue?vue&type=style&index=0&id=1dc44e53&lang=less\"","<template>\n  <HomeLayout>\n    <template #body>\n      <!--站内通知-->\n      <WebPush\n        :closable=\"false\"\n        :interval=\"3000\"\n        :show-weather=\"false\"\n        alert-type=\"success\"\n        effect=\"dark\">\n      </WebPush>\n      <!--列表页-->\n      <Lists :load-more=\"loadMore\"></Lists>\n    </template>\n  </HomeLayout>\n</template>\n\n<script>\nimport WebPush from '@/components/base/WebPush';\nimport HomeLayout from '@/components/HomeLayout';\nimport Lists from '@/components/home/Lists';\n\nexport default {\n  name: 'HomeIndex',\n  components: { Lists, HomeLayout, WebPush },\n  data() {\n    return {\n      pagination: { page: 1, limit: 20, source: 'h5', type: 'index' },\n      loadMore: []\n    };\n  },\n  computed: {\n    /* 图片列表 */\n    imageLists() {\n      return this.$store.state.index.imageLists.index.lists;\n    },\n    /* 总记录数 */\n    total() {\n      return this.$store.state.index.imageLists.index.total;\n    }\n  },\n  /* 卸载节点 */\n  beforeUnmount() {\n    window.removeEventListener('scroll', this.handleScroll);\n  },\n  created() {\n    window.addEventListener('scroll', this.handleScroll);\n  },\n  mounted() {\n    this.$nextTick(async () => {\n      await this.getImageLists(this.pagination);\n    });\n  },\n  methods: {\n    /**\n     * todo:获取图片列表\n     * @param pagination\n     * @returns {Promise<*>}\n     */\n    async getImageLists(pagination) {\n      const loading = this.$loading({\n        lock: true,\n        text: '玩命加载中。。。',\n        spinner: 'el-icon-loading',\n        background: 'rgba(225, 225, 224, 0.8)'\n      });\n      await this.$store.dispatch('index/getImageLists', pagination);\n      this.loadMore = this.loadMore.concat(this.imageLists);\n      loading.close();\n    },\n    /**\n     * todo:下滑加载数据\n     * @returns {Promise<void>}\n     */\n    async handleScroll() {\n      let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n      let scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;\n      if (scrollTop >= scrollHeight - window.innerHeight && this.imageLists.length < this.total) {\n        this.pagination.page = this.pagination.page + 1;\n        await this.getImageLists(this.pagination);\n      }\n    }\n  }\n};\n</script>\n","import { render } from \"./Home.vue?vue&type=template&id=17962ab6\"\nimport script from \"./Home.vue?vue&type=script&lang=js\"\nexport * from \"./Home.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"D:\\\\phpstudy_pro\\\\WWW\\\\vue-app\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}