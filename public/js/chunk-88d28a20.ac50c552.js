(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-88d28a20"],{2824:function(e,t,n){"use strict";var r=n("7a23"),o={key:0,class:"pagination"};function a(e,t,n,a,i,s){var c=Object(r["resolveComponent"])("el-form"),l=Object(r["resolveComponent"])("el-pagination"),u=Object(r["resolveComponent"])("el-main"),p=Object(r["resolveComponent"])("el-skeleton"),d=Object(r["resolveDirective"])("water-mark");return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createBlock"])("div",null,[Object(r["createVNode"])(p,{loading:n.loading,rows:5,animated:""},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(c,{inline:!0,class:"form"},{default:Object(r["withCtx"])((function(){return[Object(r["renderSlot"])(e.$slots,"header")]})),_:3}),Object(r["createVNode"])(u,null,{default:Object(r["withCtx"])((function(){return[Object(r["renderSlot"])(e.$slots,"body"),i.baseLayoutPagination.show_page?(Object(r["openBlock"])(),Object(r["createBlock"])("div",o,[Object(r["createVNode"])(l,{"current-page":i.baseLayoutPagination.page,"page-size":i.baseLayoutPagination.limit,total:i.baseLayoutPagination.total,layout:"total, prev, pager, next",onCurrentChange:s.currentChange},null,8,["current-page","page-size","total","onCurrentChange"])])):Object(r["createCommentVNode"])("",!0)]})),_:3}),Object(r["renderSlot"])(e.$slots,"dialog")]})),_:3},8,["loading"])],512)),[[d,{text:i.username,textColor:"rgba(0, 0, 0, .2)",font:"25px consolas, sans-serif",row:130,col:850}]])}n("99af");var i=n("4f8d"),s=n("6171"),c={name:"BaseLayout",props:{loading:{type:Boolean,default:function(){return!1}},pagination:{type:Object,default:function(){}}},watch:{pagination:function(){this.baseLayoutPagination=this.pagination}},data:function(){return{baseLayoutPagination:this.pagination||{limit:10,page:1,total:0,show_page:!1},username:"".concat(this.$store.state.baseLayout.username,"【").concat((this.Permission||{}).local||i["a"].baseURL,"】").concat((this.Permission||{}).now_time||Object(s["g"])(new Date))}},methods:{currentChange:function(e){this.$parent.currentPageChange(e)}}},l=(n("dd56"),n("6b0d")),u=n.n(l);const p=u()(c,[["render",a]]);t["a"]=p},"2ed6":function(e,t,n){"use strict";var r=n("7a23"),o=Object(r["withScopeId"])("data-v-f20f0ae0"),a=o((function(e,t,n,o,a,i){var s=Object(r["resolveComponent"])("el-button");return Object(r["openBlock"])(),Object(r["createBlock"])(s,{icon:a.attr["icon"][a.model.status],type:a.attr["type"][a.model.status],circle:"",plain:"",size:"medium",onClick:i.changeStatus},null,8,["icon","type","onClick"])})),i=n("1da1"),s=(n("96cf"),{name:"StatusRadio",props:{url:{type:String,default:function(){return""}},statusModel:{type:Object,default:function(){}}},data:function(){return{model:JSON.parse(JSON.stringify(this.statusModel)),attr:{icon:{1:"el-icon-check",2:"el-icon-close"},type:{1:"success",2:"danger"}}}},watch:{statusModel:function(){this.model=JSON.parse(JSON.stringify(this.statusModel))}},methods:{changeStatus:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("确认修改当前状态",{showClose:!1,confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then((function(){e.model.status=1===e.model.status?2:1;var t={url:e.url,model:{id:e.model.id,status:e.model.status,act:"status"}};e.$store.dispatch("UPDATE_ACTIONS",t).then((function(){setTimeout((function(){e.$emit("closeDialog")}),500)}))})).catch((function(){e.$message.info("取消修改")}));case 1:case"end":return t.stop()}}),t)})))()}}}),c=n("6b0d"),l=n.n(c);const u=l()(s,[["render",a],["__scopeId","data-v-f20f0ae0"]]);t["a"]=u},"4e06":function(e,t,n){"use strict";n.r(t);var r=n("7a23"),o=Object(r["withScopeId"])("data-v-4c6fb80f");Object(r["pushScopeId"])("data-v-4c6fb80f");var a=Object(r["createTextVNode"])(" 权限申请 ");Object(r["popScopeId"])();var i=o((function(e,t,n,i,s,c){var l=Object(r["resolveComponent"])("el-button"),u=Object(r["resolveComponent"])("el-form-item"),p=Object(r["resolveComponent"])("PermissionLists"),d=Object(r["resolveComponent"])("PermissionDialog"),m=Object(r["resolveComponent"])("BaseLayout");return Object(r["openBlock"])(),Object(r["createBlock"])(m,{loading:s.loading,pagination:s.pagination},{header:o((function(){return[Object(r["createVNode"])(u,null,{default:o((function(){return[e.Permission.auth.indexOf(s.savePermission)>-1?(Object(r["openBlock"])(),Object(r["createBlock"])(l,{key:0,icon:"el-icon-plus",plain:"",size:"mini",type:"primary",onClick:c.permissionApply},{default:o((function(){return[a]})),_:1},8,["onClick"])):Object(r["createCommentVNode"])("",!0)]})),_:1})]})),body:o((function(){return[Object(r["createVNode"])(p,{"permission-lists":c.permissionLists,onGetPermissionApply:c.getPermissionApply,onPermissionUpdate:c.permissionUpdate},null,8,["permission-lists","onGetPermissionApply","onPermissionUpdate"])]})),dialog:o((function(){return[Object(r["createVNode"])(d,{form:s.form,permissionAttr:s.permissionAttr,reForm:s.reForm,syncVisible:s.syncVisible,onGetPermissionApply:c.getPermissionApply,onGetUserAuth:c.getUserAuth},null,8,["form","permissionAttr","reForm","syncVisible","onGetPermissionApply","onGetUserAuth"])]})),_:1},8,["loading","pagination"])})),s=n("1da1"),c=(n("159b"),n("96cf"),n("2824")),l=(n("99af"),Object(r["createTextVNode"])(" 续期 "));function u(e,t){var n=Object(r["resolveComponent"])("el-table-column"),o=Object(r["resolveComponent"])("el-table"),a=Object(r["resolveComponent"])("StatusRadio"),i=Object(r["resolveComponent"])("el-button");return Object(r["openBlock"])(),Object(r["createBlock"])(o,{data:e.permissionLists},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(n,{type:"expand"},{default:Object(r["withCtx"])((function(e){return[Object(r["createVNode"])(o,{data:e.row.applyLog,border:""},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(n,{align:"center",label:"执行者",prop:"user_name"}),Object(r["createVNode"])(n,{align:"center",label:"执行时间",prop:"created_at"}),Object(r["createVNode"])(n,{align:"center",label:"执行记录",prop:"desc"})]})),_:2},1032,["data"])]})),_:1}),Object(r["createVNode"])(n,{label:"#ID",prop:"id",width:"100"}),Object(r["createVNode"])(n,{label:"申请人",prop:"username"}),Object(r["createVNode"])(n,{label:"权限地址",width:"300",align:"center","show-tooltip-when-overflow":""},{default:Object(r["withCtx"])((function(t){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])("".concat(e.baseURL).concat(t.row.href)),1)]})),_:1}),Object(r["createVNode"])(n,{align:"center",label:"授权通过",width:"150"},{default:Object(r["withCtx"])((function(n){return[e.Permission.auth.indexOf(e.URL)>-1?(Object(r["openBlock"])(),Object(r["createBlock"])(a,{key:0,statusModel:n.row,url:e.URL,onCloseDialog:t[1]||(t[1]=function(t){return e.$emit("getPermissionApply",{page:1,limit:15,show_page:!0,refresh:!0})})},null,8,["statusModel","url"])):(Object(r["openBlock"])(),Object(r["createBlock"])(i,{key:1,icon:["el-icon-check","el-icon-close"][n.row.status-1],type:["success","danger"][n.row.status-1],circle:"",plain:"",size:"medium"},null,8,["icon","type"]))]})),_:1}),Object(r["createVNode"])(n,{align:"center",label:"申请时间",prop:"created_at",width:"200"}),Object(r["createVNode"])(n,{align:"center",label:"通过时间",prop:"updated_at",width:"200"}),Object(r["createVNode"])(n,{align:"center",label:"权限期限",prop:"expires",width:"200"}),Object(r["createVNode"])(n,{align:"center",label:"操作",width:"200",fixed:"right"},{default:Object(r["withCtx"])((function(t){return[t.row.refresh&&1===t.row.status?(Object(r["openBlock"])(),Object(r["createBlock"])(i,{key:0,icon:"el-icon-refresh-right",plain:"",size:"mini",type:"primary",onClick:function(n){return e.$emit("permissionUpdate",t.row)}},{default:Object(r["withCtx"])((function(){return[l]})),_:2},1032,["onClick"])):Object(r["createCommentVNode"])("",!0)]})),_:1})]})),_:1},8,["data"])}var p=n("2ed6"),d=n("4f8d"),m={name:"PermissionLists",props:["permissionLists"],components:{StatusRadio:p["a"]},data:function(){return{URL:d["a"].permission.update,baseURL:d["a"].baseURL}}},f=n("6b0d"),b=n.n(f);const h=b()(m,[["render",u]]);var g=h,O=Object(r["withScopeId"])("data-v-f537ee58"),j=O((function(e,t,n,o,a,i){var s=Object(r["resolveComponent"])("el-option"),c=Object(r["resolveComponent"])("el-select"),l=Object(r["resolveComponent"])("el-form-item"),u=Object(r["resolveComponent"])("el-tree"),p=Object(r["resolveComponent"])("el-date-picker"),d=Object(r["resolveComponent"])("el-input"),m=Object(r["resolveComponent"])("SubmitButton"),f=Object(r["resolveComponent"])("el-form"),b=Object(r["resolveComponent"])("el-dialog");return Object(r["openBlock"])(),Object(r["createBlock"])("div",null,[Object(r["createVNode"])(b,{modelValue:e.visible,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.visible=t}),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,center:"",title:"权限申请"},{default:O((function(){return[Object(r["createVNode"])(f,{ref:n.reForm,model:a.localForm,rules:a.rules,"label-position":"left","label-width":"100px"},{default:O((function(){return[Object(r["createVNode"])(l,{label:"申请人：",prop:"user_id"},{default:O((function(){return[Object(r["createVNode"])(c,{modelValue:a.localForm.user_id,"onUpdate:modelValue":t[1]||(t[1]=function(e){return a.localForm.user_id=e}),modelModifiers:{number:!0},clearable:"",filterable:"",onChange:t[2]||(t[2]=function(t){return e.$emit("getUserAuth",a.localForm.user_id)})},{default:O((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(n.permissionAttr.userLists,(function(e,t){return Object(r["openBlock"])(),Object(r["createBlock"])(s,{key:t,label:e.username,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(r["createVNode"])(l,{label:"申请地址：",prop:"href"},{default:O((function(){return[Object(r["createVNode"])(u,{data:n.permissionAttr.authLists,props:a.props,"show-checkbox":"","default-expand-all":"","node-key":"id",ref:"tree","default-checked-keys":n.permissionAttr.checkedKeys,"highlight-current":""},null,8,["data","props","default-checked-keys"])]})),_:1}),Object(r["createVNode"])(l,{label:"过期时间：",prop:"expires"},{default:O((function(){return[Object(r["createVNode"])(p,{modelValue:a.localForm.expires,"onUpdate:modelValue":t[3]||(t[3]=function(e){return a.localForm.expires=e}),editable:!1,clearable:"",size:"large",placeholder:"选择过期时间",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]})),_:1}),Object(r["createVNode"])(l,{label:"申请理由：",prop:"desc"},{default:O((function(){return[Object(r["createVNode"])(d,{modelValue:a.localForm.desc,"onUpdate:modelValue":t[4]||(t[4]=function(e){return a.localForm.desc=e}),modelModifiers:{trim:!0},autosize:{minRows:4},maxlength:"200",placeholder:"请输入申请理由",resize:"none","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]})),_:1}),Object(r["createVNode"])(m,{form:a.submitForm,reForm:n.reForm,onCloseDialog:t[5]||(t[5]=function(t){return e.$emit("getPermissionApply",{page:1,limit:15,show_page:!0,refresh:!0})})},null,8,["form","reForm"])]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])])})),v=n("c827"),y=n("58ea"),w={name:"PermissionDialog",components:{SubmitButton:v["a"]},props:{reForm:{type:String,default:function(){return"created"}},form:{type:Object,default:function(){}},permissionAttr:{type:Object,default:function(){}}},mixins:[y["a"]],data:function(){return{localForm:this.form,submitForm:{},rules:{user_id:[{required:!0,message:"请选择申请人",trigger:"blur"}],href:[{required:!0,message:"请选择申请地址",trigger:"blur"}],expires:[{required:!0,message:"请选择申请时间",trigger:"change",type:"date"}],desc:[{required:!0,message:"请输入申请理由",trigger:"blur"}]},props:{children:"__children",label:"name",value:"api",disabled:"disable"}}},watch:{form:function(){var e=this;this.localForm=this.form,this.$nextTick((function(){setTimeout(Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.submitForm={model:e.localForm,$refs:e.$refs,url:"created"===e.reForm?d["a"].permission.save:d["a"].permission.update},e.localForm.user_id=e.$store.state.login.userInfo.id,t.next=4,e.$parent.$parent.$parent.getUserAuth(e.localForm.user_id);case 4:case"end":return t.stop()}}),t)}))),1e3)}))}}};const k=b()(w,[["render",j],["__scopeId","data-v-f537ee58"]]);var C=k,V={name:"Apply",components:{PermissionDialog:C,PermissionLists:g,BaseLayout:c["a"]},data:function(){return{loading:!0,pagination:{page:1,limit:15,total:0,show_page:!0,refresh:!1},syncVisible:!1,reForm:"created",form:{},permissionAttr:{userLists:[],authList:[],checkedKeys:[]},savePermission:d["a"].permission.save}},computed:{permissionLists:function(){return this.$store.state.apply.permissionLists}},mounted:function(){var e=this;this.$nextTick(Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getPermissionApply(e.pagination);case 2:case"end":return t.stop()}}),t)}))))},methods:{getPermissionApply:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.syncVisible=!1,t.pagination.page=e.page,n.next=4,t.$store.dispatch("apply/getPermissionApply",e);case 4:t.loading=!1,t.pagination.total=t.$store.state.apply.total;case 6:case"end":return n.stop()}}),n)})))()},currentPageChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.pagination.page=e,n.next=3,t.getPermissionApply(t.pagination);case 3:case"end":return n.stop()}}),n)})))()},getUserAuth:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$store.dispatch("apply/getUserAuth",{user_id:e,refresh:!0});case 2:t.permissionAttr={userLists:t.$store.state.users.cacheUsers,authLists:t.$store.state.apply.authLists,checkedKeys:t.getDefaultCheckedKeys(t.$store.state.apply.authLists,[])};case 3:case"end":return n.stop()}}),n)})))()},getDefaultCheckedKeys:function(e,t){var n=this;return e.forEach((function(e){e.disable||(t.push(e.id),n.form.href.push(e.api)),n.getDefaultCheckedKeys(e.__children,t)})),t},permissionApply:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.syncVisible=!0,t.next=3,e.$store.dispatch("users/getCacheUserLists",{});case 3:e.permissionAttr={userLists:e.$store.state.users.cacheUsers,authList:[],checkedKeys:[]},e.form={user_id:"",href:[],expires:"",desc:""},e.reForm="created";case 6:case"end":return t.stop()}}),t)})))()},permissionUpdate:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$store.dispatch("UPDATE_ACTIONS",{url:d["a"].permission.update,model:{id:e.id,status:e.status}});case 2:return n.next=4,t.getPermissionApply({page:1,limit:15,show_page:!0,refresh:!0});case 4:case"end":return n.stop()}}),n)})))()}}};const x=b()(V,[["render",i],["__scopeId","data-v-4c6fb80f"]]);t["default"]=x},"58ea":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={props:["syncVisible"],data:function(){return{visible:this.syncVisible}},watch:{syncVisible:function(){this.visible=this.syncVisible}}}},c827:function(e,t,n){"use strict";var r=n("7a23"),o=Object(r["withScopeId"])("data-v-167886ae"),a=o((function(e,t,n,a,i,s){var c=Object(r["resolveComponent"])("el-button"),l=Object(r["resolveComponent"])("el-main");return Object(r["openBlock"])(),Object(r["createBlock"])(l,{style:{"text-align":"center"}},{default:o((function(){return[Object(r["createVNode"])(c,{plain:"",size:"medium",type:"primary",onClick:s.saveForm},{default:o((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(n.confirmButton||"确定"),1)]})),_:1},8,["onClick"]),Object(r["createVNode"])(c,{plain:"",size:"medium",type:"default",onClick:t[1]||(t[1]=function(t){return e.$emit("closeDialog")})},{default:o((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(n.cancelButton||"取消"),1)]})),_:1})]})),_:1})})),i=n("1da1"),s=(n("96cf"),{name:"SubmitButton",props:["confirmButton","cancelButton","form","reForm"],methods:{saveForm:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.form.$refs[e.reForm].validate((function(t){if(!t)return!1;e.$store.dispatch("UPDATE_ACTIONS",e.form).then((function(){setTimeout((function(){e.$emit("closeDialog")}),500)}))}));case 2:case"end":return t.stop()}}),t)})))()}}}),c=n("6b0d"),l=n.n(c);const u=l()(s,[["render",a],["__scopeId","data-v-167886ae"]]);t["a"]=u},dd56:function(e,t,n){"use strict";n("e0ac")},e0ac:function(e,t,n){}}]);
//# sourceMappingURL=chunk-88d28a20.ac50c552.js.map